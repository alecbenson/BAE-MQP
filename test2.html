<canvas id="canvas"></canvas>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="nodes.js"></script>
<script>
  var map = {};
  map.width = 960;
  map.height = 500;

  map.canvas =
    d3.select('body')
    .append('canvas')
    .attr('width', map.width)
    .attr('height', map.height)
    .node().getContext('2d');

  map.canvas.nodes = dataset;

  d3.timer(step);

  function step() {
    map.canvas.fillStyle = "rgba(255,255,255,0.3)";
    map.canvas.fillRect(0, 0, map.width, map.height);
    map.canvas.fillStyle = "rgba(0,0,0,0.5)";
    map.moveRandom()
    map.canvas.draw();
  };

  map.moveRandom = function() {
    $(dataset).each(function(index, p) {
      p.x += Math.round(4 * Math.random() - 2);
      p.y += Math.round(4 * Math.random() - 2);
      if (p.x < 0) p.y = map.width;
      if (p.x > map.width) p.y = 0;
      if (p.y < 0) p.y = map.height;
      if (p.y > map.height) p.y = 0;
    });
  }

  map.canvas.draw = function() {
    map.canvas.clearRect(0, 0, map.width, map.height);
    map.canvas.beginPath();
    var i = -1;
    $(dataset).each(function(index, d) {
      map.canvas.moveTo(d.x, d.y);
      map.canvas.arc(d.x, d.y, d.r, 0, 2 * Math.PI);
      map.canvas.labelNode(d);
      map.connectNodes(dataset[0], dataset[1]);
      map.connectNodes(dataset[1], dataset[2]);
      map.connectNodes(dataset[3], dataset[4]);
    })
    map.canvas.fillStyle = "#FF0000"
    map.canvas.fill();
  };

  map.canvas.labelNode = function(p) {
    var textXOffset = (p.x);
    var textYOffset = (p.y - p.r - 10);
    map.canvas.font="15px Arial";
    map.canvas.textAlign = "center";
    map.canvas.fillText(p.name, textXOffset, textYOffset);
  }

  map.connectNodes = function(p, other) {
    var edge = new Path2D();
    edge.moveTo(p.x, p.y)
    edge.lineTo(other.x, other.y)
    edge.closePath();
    map.canvas.stroke(edge);
  }
</script>
